'use strict';const express=require("express"),router=express.Router(),Post=require("../../models/Post");router.all("/*",(a,d,b)=>{a.app.locals.layout="admin";b()});router.get("/",(a,d)=>{Post.find({}).then(b=>{d.render("admin/posts",{posts:b});console.log(b)}).catch(b=>console.log("Post Error: err"))});router.get("/create",(a,d)=>{d.render("admin/posts/create-post")});
router.post("/create",(a,d)=>{let b=!0;b=a.body.allowComments?!0:!1;(new Post({title:a.body.title,sub:a.body.sub,status:a.body.status,category:a.body.category,allowComments:b,imagery:a.body.imagery,body:a.body.body,date:new Date})).save().then(c=>console.log("Sent")).catch(c=>console.log(c));d.redirect("/admin/posts")});router.get("/:id/edit",(a,d)=>{Post.find({_id:a.params.id}).then(b=>{console.log(`Single post: ${b}`);d.render("admin/posts/edit",{post:b})}).catch(b=>console.log(`Error with pulling single post: ${b}`))});
router.post("/:id/update",(a,d)=>{let b=!0;b=a.body.allowComments?!0:!1;Post.findOne({_id:a.params.id}).then(c=>{console.log(c);c.title=a.body.title;c.sub=a.body.sub;c.status=a.body.status;c.category=a.body.category;c.body=a.body.body;c.allowComments=b;c.imagery=a.body.imagery;c.save().then(e=>{console.log(`New Post: ${e}`);console.log("Updated Successfully");d.redirect("/admin/posts")}).catch(e=>console.log(`Updating Error from: ${e}`))}).catch(c=>console.log(`Error from: ${c}`))});
router.get("/:id/delete",(a,d)=>{Post.findOne({_id:a.params.id}).then(b=>{console.log(b);b.delete().then(c=>console.log(`Post Deleted: ${c}`)).catch(c=>console.log(`Deleting Error from: ${c}`));d.redirect("/admin/posts")}).catch(b=>console.log(`Error: ${b}`))});module.exports=router;