'use strict';const express=require("express"),app=express(),router=express.Router(),Category=require("../../models/Category"),faker=require("faker");router.get("/*",(b,c,a)=>{c.app.locals.layout="admin";a()});router.get("/",(b,c)=>{Category.find().then(a=>{c.render("admin/category/index",{categories:a})}).catch(a=>console.log(a))});
router.post("/create",(b,c)=>{const a=new Category;a.title=b.body.title;a.date=new Date;a.save().then(d=>{console.log(`New Category: ${d}`);b.flash("success_msg",`${d.title} created successfully :)`);c.redirect("/admin/categories")}).catch(d=>console.log(d))});
router.post("/dummy",(b,c)=>{for(let a=0;a<b.body.number;a++){const d=new Category;d.title=faker.lorem.word();d.date=new Date;d.save().then(e=>{console.log(`New Category: ${e}`);b.flash("success_msg",`${b.body.number} dummy categories successfully created  :)`);c.redirect("/admin/categories")}).catch(e=>console.log(e))}});
router.get("/:id/delete",(b,c)=>{Category.deleteOne({_id:b.params.id}).then(a=>{b.flash("success_msg","Category has been deleted successfully :)");c.redirect("/admin/categories")}).catch(a=>console.log(a))});router.post("/:id/edit",(b,c)=>{Category.findOne({_id:b.params.id}).then(a=>{a.title=b.body.title;a.save().then(d=>{b.flash("success_msg","Category has been updated successfully :)");console.log(`Updated ${d}`);c.redirect("/admin/categories")})}).catch(a=>console.log(a))});module.exports=router;